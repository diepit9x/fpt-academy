<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix = "c" uri = "http://java.sun.com/jsp/jstl/core" %>
<h2>Add Content</h2>
<div class="profile-box">
  <div class="login-header">Profile from elements</div>
  <form class="profile-body creater-content-form">
    <div class="form-submit">
    <div class="form-group text-center">
              <span class="msg-response text-danger header-error"></span>
              <span class="msg-response text-success header-success"></span>
            </div>
      <div class="form-group">
        <label for="title">Title</label>
        <input type="text" class="form-control" name="title" placeholder="Enter the title" />
        <span class="msg-response text-danger title-error" id=""></span>
      </div>
      <div class="form-group">
        <label for="brief">Brief</label>
        <textarea class="form-control" name="brief" rows="3" placeholder=""></textarea>
        <span class="msg-response text-danger brief-error" id=""></span>
      </div>
      <div class="form-group">
        <label for="content">Content</label>
        <textarea class="form-control" name="content" rows="5" placeholder=""></textarea>
        <span class="msg-response text-danger content-error" id=""></span>
      </div>
      <button type="submit" class="btn btn-outline-dark formBtn">Submit Button</button>
      <button type="reset" class="btn btn-outline-dark formBtn">Reset Button</button>
    </div>
  </form>
</div>
<c:if test="${not empty contentId}">
<script>
const contentId = "${contentId}";
const apiUrl = "${pageContext.request.contextPath}/content/update";
</script>
</c:if>
<c:if test="${empty contentId}">
<script>
const apiUrl = "${pageContext.request.contextPath}/content/create";
</script>
</c:if>
<script type="text/javascript">
$(document).on("submit", ".creater-content-form", function(event) {
	event.preventDefault();
	const formBtn = $(".formBtn");

	formBtn.prop("disabled", true);
	$(".msg-response").empty();

	$.ajax({
		url: apiUrl,
		type: "POST",
		data: $(this).serialize(),
		contentType: "application/x-www-form-urlencoded",
		dataType: "json",
		success: function(response) {
			$(".header-success").text("Create successfully");
			$(".creater-content-form")[0].reset();
		},
		error: function(xhr) {
			formBtn.prop("disabled", false);
			let response = xhr.responseJSON;
			if (response.object) {
				debugger;
				// Kiểm tra xem response.object có phải là đối tượng không
				if (typeof response.object === "object" && !Array.isArray(response.object)) {
					// Xử lý khi response.object là đối tượng chứa lỗi của trường
					let fieldErrors = response.object;
					for (let field in fieldErrors) {
						let errorMessage = fieldErrors[field];
						$("." + field + "-error").text(errorMessage);
					}
				} else {
					$(".header-error").text(response.object);
				}
			} else {
				alert("Đã xảy ra lỗi. Vui lòng thử lại sau.");
			}
		},
	});
});
</script>