package fa.training.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import fa.training.daos.MayDAO;
import fa.training.entities.May;
import fa.training.models.PagedResult;
import fa.training.models.ResponseData;

@Controller
@RequestMapping(value = "/may")
public class MayController {

	@Autowired
	private MayDAO mayDAOImpl;

	@GetMapping("/tao-moi")
	public String create(Model model) {
		ResponseData responseData = new ResponseData(400, null);
		model.addAttribute("responseData", responseData);
		model.addAttribute("may", new May());
		return "pages/may/tao-moi";
	}

	@PostMapping("/tao-moi")
	public String create(Model model, @ModelAttribute("may") May may) {
		ResponseData responseData = new ResponseData(400, null);
		boolean status = mayDAOImpl.insert(may);
		if (status) {
			responseData.setStatus(200);
			responseData.setObject("Tạo máy thành công");
			model.addAttribute("responseData", responseData);
			model.addAttribute("may", new May());
			return "pages/may/tao-moi";
		}
		model.addAttribute("may", may);
		responseData.setObject("Tạo máy thất bại");
		model.addAttribute("responseData", responseData);
		return "pages/may/tao-moi";
	}

	@GetMapping("/danh-sach")
	public String getAll(@RequestParam(required = false, defaultValue = "1") int page,
			@RequestParam(required = false) String keyword, Model model) {
		page = page < 1 ? 1 : page;
		int pageSize = 2;
		PagedResult<May> pagedResult = mayDAOImpl.findAllMay(keyword, page, pageSize);
		ResponseData responseData = new ResponseData(200, pagedResult);
		model.addAttribute("responseData", responseData);
		model.addAttribute("keyword", keyword);
		return "pages/may/danh-sach";
	}

}
