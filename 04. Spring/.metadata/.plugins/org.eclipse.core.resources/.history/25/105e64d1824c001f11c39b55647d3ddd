package controllers;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import daos.KhachHangDAO;
import entities.KhachHang;
import models.ResponseData;

/**
 * Servlet implementation class KhachHangController
 */
@WebServlet("/khach-hang/*")
public class KhachHangController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private KhachHangDAO khachHangDAO;
	
    public KhachHangController() {
        super();
        khachHangDAO = new KhachHangDAO();
    }

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		String  action = request.getPathInfo();
		if (action != null) {
			action = action.substring(1); 
	    }
		switch (action) {
		case "tao-moi": {
			create(request, response);
			break;
		}
		case "danh-sach": {
			getAll(request, response);
			break;
		}
		case "cap-nhat": {
			update(request, response);
			break;
		}
		case "xoa-khach-hang": {
			delete(request, response);
			break;
		}
		case "danh-sach-su-dung": {
//			registerToUse(request, response);
			break;
		}
		default:
			System.out.println("no action");
		}
	}
	
	private void delete(HttpServletRequest request, HttpServletResponse response) throws IOException {
		//print
		PrintWriter out = response.getWriter();
		//Status
		String maKH = request.getParameter("maKH");
		try {
			Integer maKHInt = Integer.parseInt(maKH);
			boolean status = true;
			if (status) {
				out.println("Xoa thanh cong");
				response.sendRedirect(request.getContextPath() + "/may/danh-sach");
			} else {
				out.println("Xoa that bai");
			}
		} catch (Exception e) {
			out.println(e.getMessage());
		}
		
	}
	
	private void update(HttpServletRequest request, HttpServletResponse response) {
		String url = "/WEB-INF/pages/khach-hang/cap-nhat.jsp";
		
		
		
		try {
		    RequestDispatcher rd = getServletContext().getRequestDispatcher(url);
	        rd.forward(request, response);
	    } catch (ServletException e) {
	        e.printStackTrace();
	    } catch (IOException e) {
	        e.printStackTrace();
	    }
	}
	
	
	private void getAll(HttpServletRequest request, HttpServletResponse response) {
		String url = "/WEB-INF/pages/khach-hang/danh-sach.jsp";
		
		try {
		    RequestDispatcher rd = getServletContext().getRequestDispatcher(url);
	        rd.forward(request, response);
	    } catch (ServletException e) {
	        e.printStackTrace();
	    } catch (IOException e) {
	        e.printStackTrace();
	    }
	}
	
	
	private void create(HttpServletRequest request, HttpServletResponse response) {
		String url = "/WEB-INF/pages/khach-hang/tao-moi.jsp";
		ResponseData responseData = new ResponseData(400, null);
		
		String maKhachHang = request.getParameter("maKhachHang");
		String tenKhachHang = request.getParameter("tenKhachHang");
		String diaChi = request.getParameter("diaChi");
		String soDienThoai = request.getParameter("soDienThoai");
		String email = request.getParameter("email");
		
		KhachHang khachHang = new KhachHang();
		khachHang.setMaKH(maKhachHang);
		khachHang.setTenKH(tenKhachHang);
		khachHang.setDiaChi(diaChi);
		khachHang.setDiaChi(diaChi);
		khachHang.setSoDienThoai(soDienThoai);
		khachHang.setEmail(email);
		
		try {
			boolean status = khachHangDAO.insert(khachHang);
			if (status) {
				responseData.setStatus(200);
				responseData.setObject("Tạo khách hàng thành công");
			} else {
				responseData.setObject("Tạo khách hàng thất bại");
			}
		} catch (Exception e) {
			responseData.setObject(e.getMessage());
		}
		
		try {
		    RequestDispatcher rd = getServletContext().getRequestDispatcher(url);
	        rd.forward(request, response);
	    } catch (ServletException e) {
	        e.printStackTrace();
	    } catch (IOException e) {
	        e.printStackTrace();
	    }
	}
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}

}
